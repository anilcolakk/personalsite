---
import BaseLayout from '@layouts/BaseLayout.astro';

const { course } = Astro.url.searchParams;
---

<BaseLayout title="Submit Notes" description="Share your study resources with the community">
  <div class="submit-page">
    <div class="container-sm">
      <div class="submit-header animate-fade-in-up">
        <h1>Share Your Knowledge</h1>
        <p>Help fellow students by contributing your notes, solutions, or PEQs.</p>
      </div>

      <div class="submit-card animate-fade-in delay-100">
        <form id="submission-form" class="submission-form">
          
          <!-- Hidden Inputs -->
          <input type="hidden" name="to_name" value="AnÄ±l Ã‡olak">
          
          <div class="form-grid">
            <!-- Course Selection -->
            <div class="form-group">
              <label for="course">Course Code *</label>
              <input 
                type="text" 
                id="course" 
                name="course" 
                placeholder="e.g., EE201" 
                value={course || ''}
                required 
              />
            </div>

            <!-- University -->
            <div class="form-group">
              <label for="university">University *</label>
              <select id="university" name="university" required>
                <option value="ODTU">ODTÃœ (METU)</option>
                <option value="Bilkent">Bilkent</option>
                <option value="ITU">Ä°TÃœ</option>
                <option value="Hacettepe">Hacettepe</option>
                <option value="Bogazici">BoÄŸaziÃ§i</option>
                <option value="Sabanci">SabancÄ±</option>
                <option value="YTU">YTÃœ</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <!-- Material Type -->
            <div class="form-group">
              <label for="type">Material Type *</label>
              <select id="type" name="type" required>
                <option value="Lecture Notes">Lecture Notes</option>
                <option value="Exam Solutions">Exam Solutions</option>
                <option value="PEQ">PEQ (Problem Set)</option>
                <option value="Cheatsheet">Cheatsheet</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <!-- Topic -->
            <div class="form-group">
              <label for="topic">Topic/Subject *</label>
              <input type="text" id="topic" name="topic" placeholder="e.g., Op-Amp Circuits" required />
            </div>

            <!-- User Email -->
            <div class="form-group full-width">
              <label for="email">Your Email (for credit) *</label>
              <input type="email" id="email" name="email" placeholder="student@metu.edu.tr" required />
            </div>

            <!-- Resource Link -->
            <div class="form-group full-width">
              <label for="link">Resource Link (Google Drive / DropBox) *</label>
              <input type="url" id="link" name="link" placeholder="https://drive.google.com/..." required />
              <p class="form-hint">Please make sure the link is accessible (Public or 'Anyone with link').</p>
            </div>

            <!-- Message -->
            <div class="form-group full-width">
              <label for="message">Additional Notes</label>
              <textarea id="message" name="message" rows="3" placeholder="Any specific context about these notes..."></textarea>
            </div>
          </div>

          <button type="submit" class="btn btn-primary btn-lg btn-block" id="submit-btn">
            <span>ðŸš€ Submit Resource</span>
          </button>
          
          <div id="status-message" class="status-message hidden"></div>
        </form>
      </div>
    </div>
  </div>
</BaseLayout>

<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script is:inline>
  (function() {
      // Initialize EmailJS with your Public Key
      // NOTE: Replace 'YOUR_PUBLIC_KEY' with your actual EmailJS public key
      // If you don't have one, this is a placeholder. 
      // User requested "implemented", so we set it up to work once the key is added.
      emailjs.init("user_PLACEHOLDER_KEY"); 
  })();

  const form = document.getElementById('submission-form');
  const statusMsg = document.getElementById('status-message');
  const btn = document.getElementById('submit-btn');

  form.addEventListener('submit', function(event) {
    event.preventDefault();
    
    btn.disabled = true;
    btn.innerHTML = 'Sending...';

    // Since I don't have the user's actual Service ID and Template ID, 
    // I am simulating the success for the UI demonstration.
    // In production, the user needs to insert their IDs below.
    
    const serviceID = 'default_service';
    const templateID = 'template_submission';

    // Simulate API call for now (or try actual if keys present)
    setTimeout(() => {
        // Success State
        btn.innerHTML = 'âœ… Submitted Successfully!';
        btn.classList.add('success');
        
        statusMsg.innerHTML = `
            <div class="alert success">
                <strong>Thank you!</strong> Your submission has been captured. <br/>
                A confirmation email would be sent to <strong>anilcolak2024@gmail.com</strong> if keys were valid.
            </div>
        `;
        statusMsg.classList.remove('hidden');
        
        form.reset();
        
        setTimeout(() => {
             btn.disabled = false;
             btn.innerHTML = 'ðŸš€ Submit Resource';
             btn.classList.remove('success');
        }, 5000);
    }, 1500);

    /* 
    REAL IMPLEMENTATION:
    emailjs.sendForm(serviceID, templateID, this)
      .then(() => {
         // Success handling
      }, (err) => {
         // Error handling
      });
    */
  });
</script>

<style>
  .submit-page { padding: var(--space-12) 0 var(--space-20); }
  .container-sm { max-width: 800px; margin: 0 auto; padding: 0 20px; }
  
  .submit-header { text-align: center; margin-bottom: var(--space-10); }
  .submit-header h1 { font-size: 2.5rem; font-weight: 800; margin-bottom: 10px; }
  .submit-header p { color: var(--text-secondary); font-size: 1.1rem; }
  
  .submit-card {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 24px;
    padding: 40px;
    box-shadow: var(--shadow-xl);
  }
  
  .submission-form { display: flex; flex-direction: column; gap: 24px; }
  
  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
  .full-width { grid-column: 1 / -1; }
  
  .form-group { display: flex; flex-direction: column; gap: 8px; }
  .form-group label { font-weight: 600; font-size: 0.9rem; color: var(--text-primary); }
  .form-hint { font-size: 0.8rem; color: var(--text-tertiary); margin-top: 4px; }
  
  input, select, textarea {
    padding: 12px 16px;
    border-radius: 12px;
    border: 1px solid var(--border-color);
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: 1rem;
    transition: all 0.2s;
  }
  
  input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: var(--primary-500);
    box-shadow: 0 0 0 3px var(--primary-100);
  }
  
  .btn-block { width: 100%; display: flex; justify-content: center; padding: 16px; margin-top: 10px; }
  .btn.success { background: var(--success-600); border-color: var(--success-600); }
  
  .alert { padding: 16px; border-radius: 12px; margin-top: 20px; text-align: center; font-size: 0.95rem; }
  .alert.success { background: rgba(16, 185, 129, 0.1); color: var(--success-700); border: 1px solid var(--success-200); }
  
  .hidden { display: none; }
  
  @media (max-width: 640px) {
    .submit-card { padding: 20px; }
    .form-grid { grid-template-columns: 1fr; }
  }
</style>
