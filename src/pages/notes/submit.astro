---
import BaseLayout from '@layouts/BaseLayout.astro';

const { course } = Astro.url.searchParams;
---

<BaseLayout title="Submit Notes" description="Share your study resources with the community">
  <div class="submit-page">
    <div class="container-sm">
      <div class="submit-header animate-fade-in-up">
        <h1>Share Your Knowledge</h1>
        <p>Help fellow students by contributing your notes, solutions, or PEQs.</p>
      </div>

      <div class="submit-card animate-fade-in delay-100">
        <form id="submission-form" class="submission-form">
          
          <!-- Hidden Inputs -->
          <input type="hidden" name="to_name" value="Anƒ±l √áolak">
          
          <div class="form-grid">
            <!-- Course Selection -->
            <div class="form-group">
              <label for="course_code">Course Code *</label>
              <input 
                type="text" 
                id="course_code" 
                name="course_code" 
                placeholder="e.g., EE201" 
                value={course || ''}
                required 
              />
            </div>

            <!-- University -->
            <div class="form-group">
              <label for="university">University *</label>
              <select id="university" name="university" required>
                <option value="ODTU">ODT√ú (METU)</option>
                <option value="Bilkent">Bilkent</option>
                <option value="ITU">ƒ∞T√ú</option>
                <option value="Hacettepe">Hacettepe</option>
                <option value="Bogazici">Boƒüazi√ßi</option>
                <option value="Sabanci">Sabancƒ±</option>
                <option value="YTU">YT√ú</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <!-- Material Type -->
            <div class="form-group">
              <label for="resource_type">Material Type *</label>
              <select id="resource_type" name="resource_type" required>
                <option value="Lecture Notes">Lecture Notes</option>
                <option value="Exam Solutions">Exam Solutions</option>
                <option value="PEQ">PEQ (Problem Set)</option>
                <option value="Cheatsheet">Cheatsheet</option>
                <option value="Other">Other</option>
              </select>
            </div>

            <!-- Topic -->
            <div class="form-group">
              <label for="topic">Topic/Subject *</label>
              <input type="text" id="topic" name="topic" placeholder="e.g., Op-Amp Circuits" required />
            </div>

            <!-- User Name (Sync with from_name) -->
            <div class="form-group full-width">
              <label for="from_name">Your Name (for credit) *</label>
              <input type="text" id="from_name" name="from_name" placeholder="John Doe" required />
            </div>

            <!-- Resource Link -->
            <div class="form-group full-width">
              <label for="resource_link">Resource Link (Google Drive / DropBox) *</label>
              <input type="url" id="resource_link" name="resource_link" placeholder="https://drive.google.com/..." required />
              <p class="form-hint">Please make sure the link is accessible (Public or 'Anyone with link').</p>
            </div>

            <!-- Message -->
            <div class="form-group full-width">
              <label for="message">Additional Notes</label>
              <textarea id="message" name="message" rows="3" placeholder="Any specific context about these notes..."></textarea>
            </div>

            <!-- Copyright Check -->
            <div class="form-check full-width">
                <input type="checkbox" id="terms" name="terms" required />
                <label for="terms">
                  I confirm that these are my own notes/works or are open resources, and I agree to have them shared freely on this website for everyone to use (no copyright infringement).
                </label>
            </div>
          </div>

          <button type="submit" class="btn btn-primary btn-lg btn-block" id="submit-btn">
            <span>üöÄ Submit Resource</span>
          </button>
          
          <div id="status-message" class="status-message hidden"></div>
        </form>
      </div>
    </div>
  </div>
</BaseLayout>
<script type="text/javascript" src="https://cdn.jsdelivr.net/npm/@emailjs/browser@3/dist/email.min.js"></script>
<script is:inline>
  (function() {
      // Initialize EmailJS
      try {
        emailjs.init("-84xRYR4pM6pv3_1b");
      } catch(e) { console.log("EmailJS init failed", e); }
  })();

  const form = document.getElementById('submission-form');
  const statusMsg = document.getElementById('status-message');
  const btn = document.getElementById('submit-btn');

  const SERVICE_ID = 'service_7jbuats';
  const TEMPLATE_ID = 'template_5mzuzfp';

  form.addEventListener('submit', function(event) {
    event.preventDefault();
    
    btn.disabled = true;
    btn.innerHTML = 'Sending...';

    emailjs.sendForm(SERVICE_ID, TEMPLATE_ID, this)
      .then(() => {
        // Success State
        btn.innerHTML = '‚úÖ Submitted Successfully!';
        btn.classList.add('success');
        
        statusMsg.innerHTML = `
            <div class="alert success">
                <strong>Thank you!</strong> Your submission has been received. <br/>
                We will review it and add it to the site shortly.
            </div>
        `;
        statusMsg.classList.remove('hidden');
        
        form.reset();
        
        setTimeout(() => {
             btn.disabled = false;
             btn.innerHTML = 'üöÄ Submit Resource';
             btn.classList.remove('success');
        }, 5000);
      }, (err) => {
         console.error('EmailJS Error:', err);
         btn.innerHTML = '‚ùå Error';
         btn.disabled = false;
         alert('Failed to send. Please try again later.');
      });
  });
</script>

<style>
  .submit-page { padding: var(--space-12) 0 var(--space-20); }
  .container-sm { max-width: 800px; margin: 0 auto; padding: 0 20px; }
  
  .submit-header { text-align: center; margin-bottom: var(--space-10); }
  .submit-header h1 { font-size: 2.5rem; font-weight: 800; margin-bottom: 10px; }
  .submit-header p { color: var(--text-secondary); font-size: 1.1rem; }
  
  .submit-card {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: 24px;
    padding: 40px;
    box-shadow: var(--shadow-xl);
  }
  
  .submission-form { display: flex; flex-direction: column; gap: 24px; }
  
  .form-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 24px; }
  .full-width { grid-column: 1 / -1; }
  
  .form-group { display: flex; flex-direction: column; gap: 8px; }
  .form-group label { font-weight: 600; font-size: 0.9rem; color: var(--text-primary); }
  .form-hint { font-size: 0.8rem; color: var(--text-tertiary); margin-top: 4px; }

  .form-check {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    margin-top: 8px;
  }
  .form-check input {
    width: auto;
    margin-top: 4px;
    cursor: pointer;
  }
  .form-check label {
    font-size: 0.9rem;
    color: var(--text-secondary);
    line-height: 1.5;
    cursor: pointer;
  }
  
  input, select, textarea {
    padding: 12px 16px;
    border-radius: 12px;
    border: 1px solid var(--border-color);
    background: var(--bg-primary);
    color: var(--text-primary);
    font-size: 1rem;
    transition: all 0.2s;
  }
  
  input:focus, select:focus, textarea:focus {
    outline: none;
    border-color: var(--primary-500);
    box-shadow: 0 0 0 3px var(--primary-100);
  }
  
  .btn-block { width: 100%; display: flex; justify-content: center; padding: 16px; margin-top: 10px; }
  .btn.success { background: var(--success-600); border-color: var(--success-600); }
  
  .alert { padding: 16px; border-radius: 12px; margin-top: 20px; text-align: center; font-size: 0.95rem; }
  .alert.success { background: rgba(16, 185, 129, 0.1); color: var(--success-700); border: 1px solid var(--success-200); }
  
  .hidden { display: none; }
  
  @media (max-width: 640px) {
    .submit-card { padding: 20px; }
    .form-grid { grid-template-columns: 1fr; }
  }
</style>
