---
import BaseLayout from '@layouts/BaseLayout.astro';
import CourseCard from '@components/CourseCard.astro';
import { allCourses } from '../../../data/allCourses.js';

// Turkish Categories translation map
const categoryMap = {
  'Core': 'Temel',
  'Mathematics': 'Matematik',
  'Physics': 'Fizik',
  'Circuits': 'Devreler',
  'Electronics': 'Elektronik',
  'Signals': 'Sinyaller',
  'Digital Systems': 'SayÄ±sal Sistemler',
  'Fields': 'Alanlar',
  'Power': 'GÃ¼Ã§ Sistemleri',
  'Communications': 'HaberleÅŸme',
  'Control': 'Kontrol',
  'Computer': 'Bilgisayar'
};

const categories = ['TÃ¼mÃ¼', ...new Set(allCourses.map(c => c.category).map(cat => categoryMap[cat] || cat))];
const years = ['TÃ¼mÃ¼', 1, 2, 3, 4];
---

<BaseLayout title="Ders ArÅŸivi" description="ODTÃœ EEE ders notlarÄ±nÄ± ve materyallerini inceleyin">
  <section class="courses-page">
    <div class="container">
      <!-- Page Header -->
      <div class="page-header">
        <h1 class="page-title">Ders ArÅŸivi</h1>
        <p class="page-description">
          Ders notlarÄ±, sÄ±nav Ã§Ã¶zÃ¼mleri ve Ã§alÄ±ÅŸma materyallerini derslere gÃ¶re dÃ¼zenlenmiÅŸ olarak keÅŸfedin.
        </p>
      </div>
      
      <!-- Search & Filters -->
      <div class="filters-section">
        <div class="search-box">
          <svg class="search-icon" xmlns="http://www.w3.org/2000/svg" width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <path d="m21 21-4.35-4.35"></path>
          </svg>
          <input 
            type="text" 
            id="search-input"
            class="search-input" 
            placeholder="Ders adÄ± veya kodu ile ara..."
          />
        </div>
        
        <div class="filter-row">
          <div class="filter-group">
            <label class="filter-label">Kategori</label>
            <select id="category-filter" class="filter-select">
              {categories.map((cat) => (
                <option value={cat}>{cat}</option>
              ))}
            </select>
          </div>
          
          <div class="filter-group">
            <label class="filter-label">SÄ±nÄ±f</label>
            <select id="year-filter" class="filter-select">
              {years.map((year) => (
                <option value={year}>{year === 'TÃ¼mÃ¼' ? 'TÃ¼m SÄ±nÄ±flar' : `${year}. SÄ±nÄ±f`}</option>
              ))}
            </select>
          </div>
          
          <button id="reset-filters" class="btn btn-ghost">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <path d="M3 12a9 9 0 1 0 9-9 9.75 9.75 0 0 0-6.74 2.74L3 8"></path>
              <path d="M3 3v5h5"></path>
            </svg>
            SÄ±fÄ±rla
          </button>
        </div>
      </div>
      
      <!-- Results Count -->
      <div class="results-info">
        <span id="results-count">{allCourses.length}</span> ders bulundu
      </div>
      
      <!-- Courses Grid -->
      <div class="courses-grid" id="courses-grid">
        {allCourses.map((course) => (
          <div 
            class="course-item" 
            data-category={categoryMap[course.category] || course.category}
            data-year={course.year}
            data-name={course.name.toLowerCase()}
            data-code={course.code.toLowerCase()}
          >
            <!-- Note: CourseCard itself needs localization ideally, but for now we render it. -->
            <CourseCard {...course} />
          </div>
        ))}
      </div>
      
      <!-- Empty State -->
      <div id="empty-state" class="empty-state" style="display: none;">
        <div class="empty-icon">ðŸ“š</div>
        <h3>Ders bulunamadÄ±</h3>
        <p>Filtreleri veya arama terimini deÄŸiÅŸtirmeyi deneyin</p>
        <button id="clear-search" class="btn btn-secondary">AramayÄ± Temizle</button>
      </div>
    </div>
  </section>
</BaseLayout>

<style>
  .courses-page {
    padding: var(--space-12) 0 var(--space-20);
  }
  
  .page-header {
    text-align: center;
    margin-bottom: var(--space-10);
  }
  
  .page-title {
    font-size: var(--text-4xl);
    font-weight: 800;
    margin-bottom: var(--space-4);
  }
  
  .page-description {
    font-size: var(--text-lg);
    color: var(--text-secondary);
    max-width: 600px;
    margin: 0 auto;
  }
  
  /* Filters */
  .filters-section {
    background: var(--bg-card);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-xl);
    padding: var(--space-6);
    margin-bottom: var(--space-6);
  }
  
  .search-box {
    position: relative;
    margin-bottom: var(--space-4);
  }
  
  .search-icon {
    position: absolute;
    left: var(--space-4);
    top: 50%;
    transform: translateY(-50%);
    color: var(--text-tertiary);
  }
  
  .search-input {
    width: 100%;
    padding: var(--space-4) var(--space-4) var(--space-4) var(--space-12);
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    font-size: var(--text-base);
    color: var(--text-primary);
    transition: all var(--transition-fast);
  }
  
  .search-input:focus {
    border-color: var(--primary-500);
    outline: none;
    box-shadow: 0 0 0 3px var(--primary-100);
  }
  
  [data-theme="dark"] .search-input:focus {
    box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.2);
  }
  
  .filter-row {
    display: flex;
    gap: var(--space-4);
    align-items: flex-end;
  }
  
  .filter-group {
    flex: 1;
  }
  
  .filter-label {
    display: block;
    font-size: var(--text-sm);
    font-weight: 600;
    margin-bottom: var(--space-2);
    color: var(--text-secondary);
  }
  
  .filter-select {
    width: 100%;
    padding: var(--space-3);
    background: var(--bg-primary);
    border: 1px solid var(--border-color);
    border-radius: var(--radius-lg);
    color: var(--text-primary);
    font-size: var(--text-sm);
    cursor: pointer;
  }
  
  .filter-select:focus {
    border-color: var(--primary-500);
    outline: none;
  }
  
  .results-info {
    margin-bottom: var(--space-6);
    color: var(--text-tertiary);
    font-size: var(--text-sm);
  }
  
  .courses-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
    gap: var(--space-6);
  }
  
  .empty-state {
    text-align: center;
    padding: var(--space-12);
    background: var(--bg-card);
    border-radius: var(--radius-xl);
    border: 1px dashed var(--border-color);
  }
  
  .empty-icon {
    font-size: 3rem;
    margin-bottom: var(--space-4);
  }
  
  .empty-state h3 {
    font-size: var(--text-xl);
    font-weight: 700;
    margin-bottom: var(--space-2);
  }
  
  .empty-state p {
    color: var(--text-secondary);
    margin-bottom: var(--space-6);
  }
  
  @media (max-width: 768px) {
    .filter-row {
      flex-direction: column;
      align-items: stretch;
    }
  }
</style>

<script>
  function initFilters() {
    const searchInput = document.getElementById('search-input');
    const categoryFilter = document.getElementById('category-filter');
    const yearFilter = document.getElementById('year-filter');
    const resetBtn = document.getElementById('reset-filters');
    const clearBtn = document.getElementById('clear-search');
    
    if (!searchInput) return;
    
    const items = document.querySelectorAll('.course-item');
    const resultsCount = document.getElementById('results-count');
    const emptyState = document.getElementById('empty-state');
    
    function filterCourses() {
      const searchTerm = searchInput.value.toLowerCase();
      const category = categoryFilter.value;
      const year = yearFilter.value;
      
      let visibleCount = 0;
      
      items.forEach(item => {
        const itemCategory = item.dataset.category;
        const itemYear = item.dataset.year;
        const itemName = item.dataset.name;
        const itemCode = item.dataset.code;
        
        const matchesSearch = itemName.includes(searchTerm) || itemCode.includes(searchTerm);
        const matchesCategory = category === 'TÃ¼mÃ¼' || itemCategory === category;
        const matchesYear = year === 'TÃ¼mÃ¼' || itemYear === year;
        
        if (matchesSearch && matchesCategory && matchesYear) {
          item.style.display = 'block';
          visibleCount++;
        } else {
          item.style.display = 'none';
        }
      });
      
      resultsCount.textContent = visibleCount;
      emptyState.style.display = visibleCount === 0 ? 'block' : 'none';
    }
    
    if(searchInput) searchInput.addEventListener('input', filterCourses);
    if(categoryFilter) categoryFilter.addEventListener('change', filterCourses);
    if(yearFilter) yearFilter.addEventListener('change', filterCourses);
    
    if(resetBtn) resetBtn.addEventListener('click', () => {
      searchInput.value = '';
      categoryFilter.value = 'TÃ¼mÃ¼';
      yearFilter.value = 'TÃ¼mÃ¼';
      filterCourses();
    });
    
    if(clearBtn) clearBtn.addEventListener('click', () => {
      searchInput.value = '';
      filterCourses();
    });
  }
  
  document.addEventListener('DOMContentLoaded', initFilters);
  document.addEventListener('astro:page-load', initFilters);
</script>
